// Système DRY pour les glass box : border glass + backdrop glass + border-radius
@use "./_border.scss" as *;
@use "./_backdrop.scss" as *;
@use "../utils/_functions.scss" as *;
// === Box-glass colorées pour tous les thèmes ===
@use '../themes/_theme-global.scss' as *;
@use '../themes/_theme-caracs.scss' as *;
@use '../themes/_theme-entities.scss' as *;
@use 'sass:list';
@use 'sass:map';

$box-sizes: (xs, sm, md, lg, xl);

$intensity: (
  'xs': 30%,
  'sm': 40%,
  'md': 50%,
  'lg': 60%,
  'xl': 70%
);

@mixin box-glass($size, $combo: null, $sides: null) {
  @if $combo == null {
    @extend .border-glass-#{$size};
  } @else {
    @extend .border-glass-#{$combo}-#{$size}; 
  }
  @extend .bd-glass-#{$size};

  // Box-shadow
  $box-shadow: ();
  @if $sides == null {
    box-shadow: 0 0 0 rgba(0, 0, 0, 0.1);
  } @else {
    @each $side in $sides {
      @if $side == l {
        $box-shadow: list.append($box-shadow, -1px 0 0 rgba(0, 0, 0, 0.1), comma);
      } @else if $side == r {
        $box-shadow: list.append($box-shadow, 1px 0 0 rgba(0, 0, 0, 0.1), comma);
      } @else if $side == t {
        $box-shadow: list.append($box-shadow, 0 -1px 0 rgba(0, 0, 0, 0.1), comma);
      } @else if $side == b {
        $box-shadow: list.append($box-shadow, 0 1px 0 rgba(0, 0, 0, 0.1), comma);
      }
    }
    $box-shadow: filter-list($box-shadow);
    $box-shadow-str: '';
    @for $i from 1 through list.length($box-shadow) {
      $box-shadow-str: $box-shadow-str + list.nth($box-shadow, $i);
      @if $i < list.length($box-shadow) {
        $box-shadow-str: $box-shadow-str + ', ';
      }
    }
    @if list.length($box-shadow) > 0 {
      box-shadow: #{$box-shadow-str};
    }
  }
}

.box {
  --color: var(--color-white); // Couleur par défaut
  --bg-color: transparent;

  @each $size in $box-sizes {
    &-glass-#{$size} {
      @include box-glass($size);
      &::after {
        content: '';
        position: absolute;
        inset: 0;
        z-index: -1;
        border-radius: inherit;
        $intensity-value: map.get($intensity, $size);
        background: linear-gradient(
              90deg,
              color-mix(in srgb, var(--bg-color) $intensity-value * 0.75, transparent) 20%,
              color-mix(in srgb, var(--bg-color) $intensity-value * 0.9, transparent) 30%,
              color-mix(in srgb, var(--bg-color) $intensity-value * 1.1, transparent) 55%,
              color-mix(in srgb, var(--bg-color) $intensity-value * 0.75, transparent) 65%
          );
      }
    }

    @each $combo, $sides in $border-glass-combos {
      &-glass-#{$combo}-#{$size} {
        @include box-glass($size, $combo, $sides);
        $intensity-value: map.get($intensity, $size);
        background-color: color-mix(in srgb, var(--bg-color) $intensity-value, transparent);
      }
    }

    &-dash-#{$size} {
      $intensity-value: map.get($intensity, $size) * 1.1;
      background-color: color-mix(in srgb, var(--bg-color) $intensity-value, transparent);
      border: 1px dashed color-mix(in srgb, var(--color) 80%, transparent);
      @include bd-blur($size);
    }

    &-outline-#{$size} {
      $intensity-value: map.get($intensity, $size) * 0.8;
      background-color: color-mix(in srgb, var(--bg-color) $intensity-value, transparent);
      @extend .border-glass-#{$size};
      @include bd-blur($size);
    }

    &-soft-#{$size} {
      $intensity-value: map.get($intensity, $size) * 0.5;
      background-color: color-mix(in srgb, var(--bg-color) $intensity-value, transparent);
      border: 1px solid color-mix(in srgb, var(--color) 60%, transparent);
      @include bd-blur($size);
    }

    &-ghost-#{$size} {
      $intensity-value: map.get($intensity, $size) * 0.2;
      background-color: color-mix(in srgb, var(--bg-color) $intensity-value, transparent);
      @include bd-blur($size);
    }
  }
}
