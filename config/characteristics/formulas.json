{
  "metadata": {
    "version": "1.0.0",
    "description": "Formules de calcul pour les caractéristiques KrosmozJDR",
    "last_updated": "2025-01-27",
    "author": "KrosmozJDR Team"
  },
  "formulas": {
    "level/10": {
      "type": "simple",
      "description": "Division simple du niveau par 10",
      "function": "divide",
      "parameters": {
        "value": "input",
        "divisor": 10
      },
      "result_type": "integer"
    },
    "convertHealth": {
      "type": "complex",
      "description": "Conversion des points de vie avec contraintes par type d'entité",
      "function": "convertStatistic",
      "parameters": {
        "value": "input",
        "type": "context.entity_type",
        "level": "context.level",
        "baseMultiplier": 1,
        "constraints": {
          "player": {"min": 5, "max": "level * 3"},
          "npc": {"min": 3, "max": "level * 2.5"},
          "creature": {"min": 2, "max": "level * 2"}
        }
      },
      "result_type": "integer"
    },
    "convertActionPoints": {
      "type": "complex",
      "description": "Conversion des points d'action",
      "function": "convertStatistic",
      "parameters": {
        "value": "input",
        "type": "context.entity_type",
        "level": "context.level",
        "baseMultiplier": 2,
        "constraints": {
          "player": {"min": 3, "max": 6},
          "npc": {"min": 3, "max": 6},
          "creature": {"min": 2, "max": 6}
        }
      },
      "result_type": "integer"
    },
    "convertMovementPoints": {
      "type": "simple",
      "description": "Conversion directe des points de mouvement",
      "function": "direct",
      "parameters": {
        "value": "input"
      },
      "result_type": "integer"
    },
    "convertStatistic": {
      "type": "complex",
      "description": "Formule générique pour les caractéristiques de base",
      "function": "convertStatistic",
      "parameters": {
        "value": "input",
        "type": "context.entity_type",
        "level": "context.level",
        "baseMultiplier": 1,
        "constraints": {
          "player": {"min": 1, "max": "level * 2"},
          "npc": {"min": 1, "max": "level * 1.8"},
          "creature": {"min": 1, "max": "level * 1.5"}
        }
      },
      "result_type": "integer"
    },
    "convertInvocations": {
      "type": "complex",
      "description": "Conversion des invocations avec limites",
      "function": "convertInvocations",
      "parameters": {
        "value": "input",
        "type": "context.entity_type",
        "constraints": {
          "player": {"min": 1, "max": 6},
          "npc": {"min": 1, "max": 6},
          "creature": {"min": 0, "max": 6}
        }
      },
      "result_type": "integer"
    },
    "convertInitiative": {
      "type": "complex",
      "description": "Conversion de l'initiative",
      "function": "convertStatistic",
      "parameters": {
        "value": "input",
        "type": "context.entity_type",
        "level": "context.level",
        "baseMultiplier": 0.5,
        "constraints": {
          "player": {"min": 2, "max": "level * 2"},
          "npc": {"min": 2, "max": "level * 1.8"},
          "creature": {"min": 1, "max": "level * 1.5"}
        }
      },
      "result_type": "integer"
    },
    "calculateTouch": {
      "type": "calculated",
      "description": "Calcul du touché à partir d'autres caractéristiques",
      "function": "calculateTouch",
      "parameters": {
        "level": "context.level",
        "agility": "context.agility"
      },
      "formula": "max(0, (level * 0.5) + (agility * 0.3))",
      "result_type": "integer"
    },
    "calculateArmorClass": {
      "type": "calculated",
      "description": "Calcul de la classe d'armure à partir d'autres caractéristiques",
      "function": "calculateArmorClass",
      "parameters": {
        "level": "context.level",
        "vitality": "context.vitality"
      },
      "formula": "max(0, (level * 0.5) + (vitality * 0.3))",
      "result_type": "integer"
    },
    "convertDodge": {
      "type": "complex",
      "description": "Conversion des esquives",
      "function": "convertStatistic",
      "parameters": {
        "value": "input",
        "type": "context.entity_type",
        "level": "context.level",
        "baseMultiplier": 0.1,
        "constraints": {
          "player": {"min": 0, "max": "level * 1.5"},
          "npc": {"min": 0, "max": "level * 1.2"},
          "creature": {"min": 0, "max": "level * 1"}
        }
      },
      "result_type": "integer"
    },
    "convertTackle": {
      "type": "complex",
      "description": "Conversion du tacle",
      "function": "convertStatistic",
      "parameters": {
        "value": "input",
        "type": "context.entity_type",
        "level": "context.level",
        "baseMultiplier": 0.1,
        "constraints": {
          "player": {"min": 0, "max": "level * 1.5"},
          "npc": {"min": 0, "max": "level * 1.2"},
          "creature": {"min": 0, "max": "level * 1"}
        }
      },
      "result_type": "integer"
    },
    "convertEscape": {
      "type": "complex",
      "description": "Conversion de la fuite",
      "function": "convertStatistic",
      "parameters": {
        "value": "input",
        "type": "context.entity_type",
        "level": "context.level",
        "baseMultiplier": 0.1,
        "constraints": {
          "player": {"min": 0, "max": "level * 1.5"},
          "npc": {"min": 0, "max": "level * 1.2"},
          "creature": {"min": 0, "max": "level * 1"}
        }
      },
      "result_type": "integer"
    }
  },
  "functions": {
    "divide": {
      "description": "Division simple",
      "implementation": "return $value / $divisor;"
    },
    "direct": {
      "description": "Conversion directe sans modification",
      "implementation": "return $value;"
    },
    "convertStatistic": {
      "description": "Conversion générique avec contraintes",
      "implementation": "return max($constraints[$type]['min'], min($constraints[$type]['max'], ($value / (10 * $baseMultiplier)) + ($level * 0.5)));"
    },
    "convertInvocations": {
      "description": "Conversion des invocations avec limites strictes",
      "implementation": "return min($constraints[$type]['max'], max($constraints[$type]['min'], $value));"
    },
    "calculateTouch": {
      "description": "Calcul du touché",
      "implementation": "return max(0, ($level * 0.5) + ($agility * 0.3));"
    },
    "calculateArmorClass": {
      "description": "Calcul de la classe d'armure",
      "implementation": "return max(0, ($level * 0.5) + ($vitality * 0.3));"
    }
  }
}
